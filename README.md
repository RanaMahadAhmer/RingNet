# RingNet API Endpoints

This document provides detailed information about the API endpoints used in the RingNet application for weather, flood, tsunami, and emergency contact data.

## Table of Contents
1. [Authentication](#authentication)
2. [User Location Update](#user-location-update)
3. [Weather Endpoints](#weather-endpoints)
4. [Flood Endpoints](#flood-endpoints)
5. [Tsunami Endpoints](#tsunami-endpoints)
6. [Emergency Contacts Endpoints](#emergency-contacts-endpoints)

## Authentication

All API endpoints (except for login/register) require a valid JWT token in the request header:
```
Authorization: Bearer <token>
```

## User Location Update

### Update User Location
```
PUT /api/users/location
```

**Request Body:**
```json
{
  "location": {
    "latitude": 37.7749,
    "longitude": -122.4194
  }
}
```

**Response:**
```json
{
  "message": "Location updated successfully"
}
```

## Weather Endpoints

### Get User Weather Data
```
GET /api/weather/user
```

**Query Parameters:**
- `latitude` (optional): Current user latitude
- `longitude` (optional): Current user longitude

**Response:**
```json
{
  "clusterId": "string",
  "location": {
    "latitude": 37.7749,
    "longitude": -122.4194
  },
  "temperature": 22.5,
  "feelsLike": 23.1,
  "humidity": 65,
  "windSpeed": 5.2,
  "description": "Clear sky",
  "alerts": [],
  "metadata": {
    "forecast": [
      {
        "date": "2023-08-10",
        "temperature": 24.5,
        "description": "Sunny",
        "isHeatwave": false
      }
    ]
  }
}
```

### Get Current Weather
```
GET /api/weather/current
```

**Response:**
Array of weather data for all monitored locations.

## Flood Endpoints

### Get User Flood Data
```
GET /api/flood/user/floods
```

**Query Parameters:**
- `latitude` (optional): Current user latitude
- `longitude` (optional): Current user longitude

**Response:**
```json
{
  "location": {
    "latitude": 37.7749,
    "longitude": -122.4194
  },
  "clusterId": "string",
  "hasAlert": true,
  "alerts": [
    {
      "date": "2023-08-10",
      "riverDischarge": 450,
      "alertLevel": "Warning"
    }
  ]
}
```

### Get Floods By Location
```
GET /api/flood
```

**Query Parameters:**
- `latitude` (required): Location latitude
- `longitude` (required): Location longitude
- `radius` (optional): Search radius in kilometers (default: 50)

**Response:**
Array of flood data near the specified location.

## Tsunami Endpoints

### Get User Tsunami Alerts
```
GET /api/tsunami/user/alerts
```

**Response:**
```json
{
  "location": {
    "latitude": 37.7749,
    "longitude": -122.4194
  },
  "alerts": [
    {
      "title": "Tsunami Alert - High",
      "date": "2023-08-10T14:30:00Z",
      "message": "A high tsunami alert has been issued near your area...",
      "severity": "High",
      "distance": 120.5,
      "link": "https://tsunami.gov/events/123"
    }
  ]
}
```

## Emergency Contacts Endpoints

### Get Emergency Contacts
```
GET /api/emergency-contacts
```

**Query Parameters:**
- `latitude` (optional): Current user latitude
- `longitude` (optional): Current user longitude

**Response:**
```json
[
  {
    "dept": "Police",
    "contact": "911",
    "status": "Available"
  },
  {
    "dept": "Fire Department",
    "contact": "912",
    "status": "Available"
  },
  {
    "dept": "Ambulance",
    "contact": "108",
    "status": "Available"
  },
  {
    "dept": "Disaster Management",
    "contact": "1077",
    "status": "Available"
  }
]
```

## Data Sources

- **Weather Data**: OpenWeatherMap API
- **Flood Data**: Meteo Flood API
- **Tsunami Data**: GDACS Tsunami API 
- **Emergency Contacts**: Generated by Gemini AI based on location

## Implementation Details

1. **Location Updates**:
   - When endpoints are called with latitude/longitude parameters, the user's location is updated in the database
   - If no location is provided, the system uses the last saved location

2. **Caching Strategy**:
   - Weather and flood data is cached in clusters to reduce API calls
   - Tsunami data is refreshed every 24 hours

3. **Error Handling**:
   - All endpoints return appropriate HTTP status codes
   - If location services are unavailable, endpoints fall back to last known location 